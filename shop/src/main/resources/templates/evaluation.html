<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <script type="text/javascript" src="/js/jquery-1.8.1.min.js"></script>
    <script type="text/javascript" src="/js/markingSystem.js"></script>
    <title>评价</title>
    <link type="text/css" rel="stylesheet" href="/css/style.css"/>
    <!--fy-alert-->
    <link type="text/css" rel="stylesheet" href="/css/fy-alert.css"/>
    <script type="text/javascript" src="/js/fy-alert.js"></script>
    <style>
        .set_image_all {
            cursor: pointer;
            position: relative;
        }

        .set_image_all .set_image_item {
            position: relative;
            display: inline-block;
            z-index: 11;
            visibility: visible;
        }

        .set_image_all .set_image_top {
            position: absolute;
            left: 0;
            top: 0;
            z-index: 10;
        }

        .set_image_all .set_image_top > div {
            display: inline-block;
            overflow: hidden;
        }

        .set_image_all .set_image_top > div > img {
            height: 100%;
        }

        .grade {
            vertical-align: top;
        }
    </style>
</head>

<body>
<div class="headerbox">
    <div class="header">
        <div class="headerL">
            <a href="orders" class="goback"><img src="/images/goback.png"/></a>
        </div>
        <div class="headerC">
            <p>评价晒单</p>
        </div>
        <div class="headerR"></div>
    </div>
</div>
<div class="clear"></div>
<div class="hbox"></div>
<div class="pingjiabox1">
    <div class="pjleft"><img th:src="${order.productImgUrl}"/></div>
    <div class="pjright">
        <p class="p1" th:text="${order.title}">秋冬款韩版低圆领中长款宽松套头打底毛衣</p>
        <p class="p2" th:text="${order.standardInfo}">颜色：白色；尺码：均码；</p>
        <p class="p3" th:text="${'￥'+order.totalPrice/100.0}">￥69.00</p>
    </div>
</div>
<div class="clear"></div>
<div class="pingjiabox2">
    <div class="pjbox2_l">描述相符</div>
    <div class="pjbox2_r">
        <div id="desc_star"></div>
    </div>
    <div class="clear"></div>
    <div class="yijian">
        <textarea name="comment" id="comment" cols="" rows="" placeholder="请输入您的评价"></textarea>
    </div>
    <!--<div class="picture">-->
    <!--<img src="/images/pic.png"/>-->
    <!--<img src="/images/picad.png"/>-->
    <!--<img src="/images/picad.png"/>-->
    <!--<img src="/images/picad.png"/>-->
    <!--</div>-->
</div>
<div class="clear"></div>
<div class="kbox"></div>
<div class="pingjiabox2">
    <div class="pjbox2_l fon">店铺评分</div>
</div>
<div class="pingjiabox2 bort">
    <div class="pjbox2_l">质量满意</div>
    <div class="pjbox2_r">
        <div id="quality_star"></div>
    </div>
</div>
<div class="pingjiabox2 bort">
    <div class="pjbox2_l">服务态度</div>
    <div class="pjbox2_r">
        <div id="service_star"></div>
    </div>
</div>
<div class="pingjiabox2 bort">
    <div class="pjbox2_l">配送服务</div>
    <div class="pjbox2_r">
        <div id="ship_star"></div>
    </div>
</div>
<div class="fbox2"></div>
<div class="hejiBox jiesuan">
    <div class="heji" onclick="submit()">
        <div class="fabiao">
            <a >确认发表</a>
        </div>
    </div>
</div>
</body>
<script th:inline="javascript">
    var cnt = 0;
    var orderId = [[${order.id}]];

    function warnInfo(msg) {
        fyAlert.msg(msg, {icon: 2, animateType: 1});
    }

    function submit() {
        var comment = $("#comment").val();
        if (comment == '' && cnt < 2) {
            cnt++;
            switch (cnt) {
                case 1:
                    warnInfo("不说点什么吗?不想说就再点一次吧");
                    return;
                case 2:
                    warnInfo("你可以真懒得可以,罢了,再点一次放你走");
                    return;
            }
            comment = '我就是懒得写...';
        }

        var submitForm = {};
        submitForm.desc_star = getGrade("desc_star");
        submitForm.quality_star = getGrade("quality_star");
        submitForm.service_star = getGrade("service_star");
        submitForm.ship_star = getGrade("ship_star");
        submitForm.comment = comment;
        $.ajax({
            type: "post",
            url: '/shop/comment/' + orderId,
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(submitForm),
            success: function (resp) {
                if (resp.status == 'SUCCESS') {
                    window.location.href = "evaluateSuccess";
                } else {
                    warnInfo(resp.msg);
                }
            }
        });
    }

    function getGrade(id) {
        if ($("#" + id).attr('value')) {
            return $("#" + id).attr('value');
        }
        return 5;
    }

    $("#desc_star").markingSystem({
        num: 5,
        havePoint: false,
        haveGrade: false,
        unit: '星',
        grade: 5,
        height: 20,
        width: 20,
    });
    $("#quality_star").markingSystem({
        num: 5,
        havePoint: false,
        haveGrade: false,
        unit: '星',
        grade: 5,
        height: 20,
        width: 20,
    });
    $("#service_star").markingSystem({
        num: 5,
        havePoint: false,
        haveGrade: false,
        unit: '星',
        grade: 5,
        height: 20,
        width: 20,
    });
    $("#ship_star").markingSystem({
        num: 5,
        havePoint: false,
        haveGrade: false,
        unit: '星',
        grade: 5,
        height: 20,
        width: 20,
    });
</script>
</html>
