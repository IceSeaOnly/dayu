<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>FastShop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

    <link rel="shortcut icon" href="/images/favicon.ico">
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="/css/icons.min.css" rel="stylesheet" type="text/css"/>
    <link href="/css/theme.min.css" rel="stylesheet" type="text/css"/>

    <link href="/plugins/daterangepicker/daterangepicker.css" rel="stylesheet" type="text/css"/>
    <link href="/plugins/select2/select2.min.css" rel="stylesheet" type="text/css"/>
    <link href="/plugins/switchery/switchery.min.css" rel="stylesheet" type="text/css"/>
    <link href="/plugins/bootstrap-colorpicker/bootstrap-colorpicker.min.css" rel="stylesheet" type="text/css"/>
    <link href="/plugins/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css"/>


</head>

<body>

<!-- Begin page -->
<div id="layout-wrapper">
    <div class="header-border"></div>


    <!-- ========== Left Sidebar Start ========== -->
    <div th:include="manage/menus"></div>
    <!-- Left Sidebar End -->

    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="main-content">

        <div class="page-content">
            <div class="container-fluid">

                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box d-flex align-items-center justify-content-between">
                            <h4 class="mb-0 font-size-18">订单管理</h4>
                        </div>
                    </div>
                </div>
                <!-- end page title -->

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <input type="text" class="form-control date" id="datepicker"
                                       onchange="dateChange()"
                                       th:value="${date}"
                                       data-toggle="daterangepicker" data-single-date-picker="true"
                                       style="width: 200px">
                                <div class="mt-3">
                                    <div class="custom-control custom-checkbox custom-control-inline"
                                         th:each="state:${statusMap}">
                                        <input type="checkbox"
                                               class="custom-control-input"
                                               name="statusCheckBox"
                                               onchange="statusCheckBoxChange()"
                                               th:value="${state.value.name()}"
                                               th:checked="${currentStatus.contains(state.value.name())}"
                                               th:id="${'stateId_'+state.key}">
                                        <label class="custom-control-label" th:for="${'stateId_'+state.key}"
                                               th:text="${state.value.name}">Check this custom checkbox</label>
                                    </div>
                                </div>
                                <div style="height: 15px"></div>
                                <table id="datatable-buttons" class="table table-striped dt-responsive nowrap">
                                    <thead>
                                    <tr>
                                        <th>订单类型</th>
                                        <th>商品</th>
                                        <th>买家</th>
                                        <th>规格</th>
                                        <th>单价</th>
                                        <th>数量</th>
                                        <th>总价</th>
                                        <th>备注</th>
                                        <th>下单时间</th>
                                        <th>拼团状态</th>
                                        <th>订单状态</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>


                                    <tbody>
                                    <tr th:each="order:${orders}">
                                        <td>
                                            <span class="badge badge-info badge-pill"
                                                  th:if="${order.ptOrder == null || order.ptOrder == false}">普通</span>
                                            <span class="badge badge-secondary badge-pill"
                                                  th:if="${order.ptOrder != null && order.ptOrder == true}"
                                                  th:text="${order.product.ptSize+'人团'}">3人团</span>
                                        </td>

                                        <td>
                                            <a th:href="${'http://127.0.0.1:8080/manage/editGoods?id='+order.productId}"
                                               target="_blank"><img
                                                    data-toggle="tooltip"
                                                    data-placement="top" title=""
                                                    th:data-original-title="${order.product.title}"
                                                    style="width: 50px;height: 50px" th:src="${order.product.imgUrl}"/>
                                            </a>
                                        </td>

                                        <td>
                                            <img style="width: 50px;height: 50px"
                                                 data-toggle="tooltip"
                                                 data-placement="top" title=""
                                                 th:data-original-title="${order.buyerName}"
                                                 th:src="${order.buyerAvatar}"/></td>
                                        <td th:text="${order.standardInfo}">System Architect</td>
                                        <td th:text="${'￥'+order.price/100.0}">System Architect</td>
                                        <td th:text="${order.size}">System Architect</td>
                                        <td th:text="${'￥'+order.totalPrice/100.0}">System Architect</td>
                                        <td><img
                                                data-toggle="tooltip"
                                                data-placement="top" title=""
                                                th:data-original-title="${order.remark}"
                                                style="width: 20px;height: 20px"
                                                src="http://cdn.binghai.site/7b21feae-d5d7-3600-bb70-fac967adeb3d.png"/>
                                        </td>
                                        <td th:text="${order.createdTime.substring(10)}">System Architect</td>

                                        <td th:if="${order.ptOrder != null && order.ptOrder}"
                                            th:text="${order.tuanStatus.desc}">System Architect
                                        </td>
                                        <td th:if="${order.ptOrder == null || ptOrder == false}">-</td>

                                        <td th:text="${statusMap[order.status].getName()}">System Architect</td>
                                        <td>
                                            <div class="btn-group" role="group"
                                                 th:if="${order.status == 2 ||order.status == 3}">
                                                <button id="btnGroupDrop1" type="button"
                                                        class="btn btn-outline-secondary dropdown-toggle"
                                                        data-toggle="dropdown" aria-haspopup="true"
                                                        aria-expanded="false">
                                                    选择 <i class="mdi mdi-chevron-down"></i>
                                                </button>
                                                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1"
                                                     x-placement="bottom-start"
                                                     style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 35px, 0px);">
                                                    <a class="dropdown-item"
                                                       th:href="${'javascript:markProcessing('+order.id+')'}"
                                                       th:if="${order.status == 2}">标记发货</a>
                                                    <a class="dropdown-item"
                                                       th:href="${'javascript:markComplete('+order.id+')'}"
                                                       th:if="${order.status == 3}">标记完成</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>

                            </div> <!-- end card body-->
                        </div> <!-- end card -->
                    </div><!-- end col-->
                </div>
                <!-- end row-->


            </div> <!-- container-fluid -->
        </div>
        <!-- End Page-content -->


    </div>
    <!-- end main content-->

</div>
<!-- END layout-wrapper -->

<!-- Overlay-->
<div class="menu-overlay"></div>

<script>
    function markProcessing(oid) {
        markOrder2Status(oid,3);
    }

    function markComplete(oid) {
        markOrder2Status(oid,4);
    }

    function markOrder2Status(oid, status) {
        $.getJSON('markOrder?oid=' + oid + '&status=' + status, function (resp) {
            window.location.reload();
        })
    }

    function dateChange() {
        if (window.location.href.indexOf($("#datepicker").val()) == -1) {
            statusCheckBoxChange();
        }
    }

    function statusCheckBoxChange() {
        var ss = '';
        $("[name='statusCheckBox']").each(function () {
            if ($(this).is(':checked')) {
                ss += ',' + $(this).val();
            }
        })
        if (ss != '') {
            ss = ss.substr(1);
        }
        window.location.href = "orderManage?status=" + ss + "&date=" + $("#datepicker").val();
    }
</script>
<!-- jQuery  -->
<script src="/js/jquery-1.8.1.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/metismenu.min.js"></script>
<script src="/js/waves.js"></script>
<script src="/js/simplebar.min.js"></script>

<!-- third party js -->
<script src="/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/plugins/datatables/dataTables.bootstrap4.js"></script>
<script src="/plugins/datatables/dataTables.responsive.min.js"></script>
<script src="/plugins/datatables/responsive.bootstrap4.min.js"></script>
<script src="/plugins/datatables/dataTables.buttons.min.js"></script>
<script src="/plugins/datatables/buttons.bootstrap4.min.js"></script>
<script src="/plugins/datatables/buttons.html5.min.js"></script>
<script src="/plugins/datatables/buttons.flash.min.js"></script>
<script src="/plugins/datatables/buttons.print.min.js"></script>
<script src="/plugins/datatables/dataTables.keyTable.min.js"></script>
<script src="/plugins/datatables/dataTables.select.min.js"></script>
<script src="/plugins/datatables/pdfmake.min.js"></script>
<script src="/plugins/datatables/vfs_fonts.js"></script>

<!-- Plugins js -->
<script src="/plugins/autonumeric/autoNumeric-min.js"></script>
<script src="/plugins/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
<script src="/plugins/bootstrap-maxlength/bootstrap-maxlength.min.js"></script>
<script src="/plugins/moment/moment.js"></script>
<script src="/plugins/daterangepicker/daterangepicker.js"></script>
<script src="/plugins/select2/select2.min.js"></script>
<script src="/plugins/switchery/switchery.min.js"></script>
<script src="/plugins/bootstrap-colorpicker/bootstrap-colorpicker.min.js"></script>
<script src="/plugins/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>
<!-- third party js ends -->

<!-- Sparkline Js-->
<script src="/plugins/jquery-sparkline/jquery.sparkline.min.js"></script>
<!-- Chart Js-->
<script src="/plugins/jquery-knob/jquery.knob.min.js"></script>
<!-- Chart Custom Js-->
<!--<script src="assets/pages/knob-chart-demo.js"></script>-->
<!-- Morris Js-->
<script src="/plugins/morris-js/morris.min.js"></script>
<!-- Raphael Js-->
<script src="/plugins/raphael/raphael.min.js"></script>
<!-- Custom Js -->
<!--<script src="assets/pages/dashboard-demo.js"></script>-->
<!-- App js -->
<script src="/js/theme.js"></script>
<script src="/js/table-init.js"></script>
<script src="/js/date-picker-init.js"></script>
</body>

</html>